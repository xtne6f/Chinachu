dofile(mg.script_name:gsub('[^\\/]*$','')..'akarin.lua')

code=404
ct=''
if mg.request_info.uri:match('/operator/stream.txt') then
  code=204
  f=io.open(edcb.Convert('cp932','utf-8',edcb.GetPrivateProfile('SET','ModulePath','','Common.ini')..'\\EpgTimerSrvNotifyLog.txt'))
  if f then
    code=200
    ct=edcb.Convert('utf-8','cp932',f:read('*a'))
    f:close()
  end
end

zl=Deflate(ct)
mg.write('HTTP/1.1 '..code..' '..mg.get_response_code_text(code)..'\r\nContent-Type: text/plain\r\n'..(zl and 'Content-Encoding: deflate\r\n' or '')
  ..'Content-Length: '..(zl and #zl or #ct)..(mg.keep_alive(true) and '' or '\r\nConnection: close')..'\r\n\r\n', zl or ct)
